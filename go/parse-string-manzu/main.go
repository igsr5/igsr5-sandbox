'SELECT "gingerale_supplydemand"."id", "gingerale_supplydemand"."create_at", ' '"gingerale_supplydemand"."update_at", "gingerale_supplydemand"."start_time", ' '"gingerale_supplydemand"."end_time", "gingerale_supplydemand"."supply", ' '"gingerale_supplydemand"."demand", COUNT((SELECT COUNT(U0."id") AS "count" ' 'FROM "gingerale_trip" U0 LEFT OUTER JOIN "gingerale_quote" U1 ON (U0."id" = ' 'U1."trip_id") LEFT OUTER JOIN "gingerale_route" U2 ON (U0."id" = ' 'U2."trip_id") LEFT OUTER JOIN "gingerale_charter" U3 ON (U0."id" = ' 'U3."trip_id") WHERE (NOT CASE WHEN (U0."request_at" IS NULL) THEN %s ELSE %s ' 'END AND (CASE WHEN (U0."reserved_time" IS NULL) THEN U0."request_at" WHEN ' 'NOT (U0."reserved_time" IS NULL) THEN U0."reserved_time" ELSE NULL END AT ' "TIME ZONE 'Asia/Tokyo')::date BETWEEN %s AND %s AND EXTRACT('dow' FROM CASE " 'WHEN (U0."reserved_time" IS NULL) THEN U0."request_at" WHEN NOT ' '(U0."reserved_time" IS NULL) THEN U0."reserved_time" ELSE NULL END AT TIME ' 'ZONE \'Asia/Tokyo\') + 1 IN (%s) AND U0."enabled" AND U0."request_at" < ' '(DATE_TRUNC(\'day\', CASE WHEN (U0."reserved_time" IS NULL) THEN ' 'U0."request_at" WHEN NOT (U0."reserved_time" IS NULL) THEN ' 'U0."reserved_time" ELSE NULL END AT TIME ZONE \'Asia/Tokyo\') - %s) AND ' '(CASE WHEN (U2."id" IS NOT NULL OR U3."id" IS NOT NULL) THEN (CASE WHEN ' '(U0."reserved_time" IS NULL) THEN U0."request_at" WHEN NOT ' '(U0."reserved_time" IS NULL) THEN U0."reserved_time" ELSE NULL END - (%s * ' 'CASE WHEN (U2."id" IS NOT NULL) THEN U2."pickup_time" WHEN (U3."id" IS NOT ' 'NULL) THEN U3."pickup_time" ELSE %s END)) ELSE (CASE WHEN ' '(U0."reserved_time" IS NULL) THEN U0."request_at" WHEN NOT ' '(U0."reserved_time" IS NULL) THEN U0."reserved_time" ELSE NULL END - %s) END ' "AT TIME ZONE 'Asia/Tokyo')::time <= DATE_TRUNC('second', " '"gingerale_supplydemand"."end_time" AT TIME ZONE \'Asia/Tokyo\')::time AND ' '(CASE WHEN (U2."id" IS NOT NULL OR U3."id" IS NOT NULL) THEN (CASE WHEN ' '(U0."reservation_type" = %s) THEN U0."end_time" WHEN (U2."id" IS NOT NULL ' 'AND U2."departure_time" IS NOT NULL) THEN ((U2."departure_time" + (%s * ' 'U2."waiting_time")) + (%s * U2."riding_time")) WHEN (U2."id" IS NOT NULL AND ' 'CASE WHEN NOT (U0."reserved_time" IS NULL) THEN U0."reserved_time" WHEN ' '(U0."fixed_eta" IS NOT NULL) THEN U0."fixed_eta" WHEN (U0."reserved_time" IS ' 'NULL AND U1."id" IS NOT NULL AND U1."accept_at" IS NOT NULL) THEN ' '(U1."accept_at" + (%s * U1."required_time")) ELSE NULL END IS NOT NULL) THEN ' '((CASE WHEN NOT (U0."reserved_time" IS NULL) THEN U0."reserved_time" WHEN ' '(U0."fixed_eta" IS NOT NULL) THEN U0."fixed_eta" WHEN (U0."reserved_time" IS ' 'NULL AND U1."id" IS NOT NULL AND U1."accept_at" IS NOT NULL) THEN ' '(U1."accept_at" + (%s * U1."required_time")) ELSE NULL END + (%s * ' 'U2."waiting_time")) + (%s * U2."riding_time")) ELSE NULL END + (%s * CASE ' 'WHEN (U2."id" IS NOT NULL) THEN U2."recovery_time" WHEN (U3."id" IS NOT ' 'NULL) THEN U3."recovery_time" ELSE %s END)) ELSE (CASE WHEN ' '(U0."reserved_time" IS NULL) THEN U0."request_at" WHEN NOT ' '(U0."reserved_time" IS NULL) THEN U0."reserved_time" ELSE NULL END + %s) END ' "AT TIME ZONE 'Asia/Tokyo')::time > DATE_TRUNC('second', " '"gingerale_supplydemand"."start_time" AT TIME ZONE \'Asia/Tokyo\')::time) ' 'GROUP BY U0."id")) AS "benchmark" FROM "gingerale_supplydemand" WHERE ' '("gingerale_supplydemand"."end_time" > %s AND ' '"gingerale_supplydemand"."start_time" <= %s) GROUP BY ' '"gingerale_supplydemand"."id"'
